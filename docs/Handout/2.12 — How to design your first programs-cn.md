# 2.12 — 如何设计你的第一个程序

From [Learncpp](https://www.learncpp.com/cpp-tutorial/how-to-design-your-first-programs/) By **[\*Alex\*](https://www.learncpp.com/author/Alex/)** **2021 年 6 月 20 日** 

现在您已经了解了有关程序的一些基础知识，让我们更仔细地*了解如何*设计程序。

当您坐下来编写程序时，通常您会有某种想法，想为其编写程序。新程序员经常难以弄清楚如何<u>**将这个想法转化为实际代码**</u>。但事实证明，你已经拥有许多从日常生活中获得的解决问题的技能。

要记住的最重要的事情（也是最难做的事情）是*<u>在开始编码之前</u>***设计程序**。在许多方面，编程就像建筑。如果你试图在不遵循建筑计划的情况下建造房子会发生什么？很有可能，除非你非常有才华，否则你最终会得到一个有诸多问题的房子：墙壁不直，屋顶漏水等等......。同样，<u>如果您在制定一个好的计划之前就尝试编程，您可能会发现您的代码有很多问题，并且您将不得不花费大量时间来解决本可以通过提前考虑完全避免的问题</u>。

从长远来看，一些前期计划将为您节省时间和挫败感。

在本教程中，我们将展示一种将想法转换为简单函数式程序的通用方法。

## 1. 设计

### 设计步骤 1：定义您的目标

为了编写一个成功的程序，首先需要定义您的目标是什么。理想情况下，您应该能够用一两句话阐述清楚。从用户的立场来表达目标是极其重要的。例如：

- 允许用户组织姓名和相关电话号码的列表。
- 生成随机地牢，生成有趣的洞穴。
- 为具有高股息的股票生成股票推荐列表。
- 模拟从塔上掉下来的球落地需要多长时间。

尽管这个步骤显而易见，但却非常重要。您能做的最糟糕的事情就是编写一个实际上并没有按照您（或您的老板）想要的方式执行的程序！

### 设计步骤 2：定义需求

虽然定义你的问题可以帮助你确定你想要*什么*结果，但它仍然是模糊的。下一步是考虑需求。

需求是您的解决方案需要遵守的约束（例如预算、时间线、空间、内存等）以及程序必须展示以满足用户需求的功能。请注意，您的要求同样应该<u>关注“什么”，而不是“如何”</u>。

例如：

- 应保存电话号码，以便日后调用。
- 随机地牢应始终包含从入口到出口的方法。
- 股票建议应利用历史定价数据。
- 用户应该能够输入塔的高度。
- 我们需要 7 天内的可测试版本。
- 该程序应在用户提交请求后的 10 秒内产生结果。
- 该程序的宕机率应该少于 0.1% 。

<u>一个问题可能会产生许多需求，而解决方案只有在满足所有需求时才“完成”。</u>

### 设计步骤 3：定义您的工具、目标和备份计划

如果您是一位经验丰富的程序员，此时通常会执行许多其他步骤，包括：

- 定义您的程序将在什么目标架构和/或操作系统上运行。
- 确定您将使用的工具集。
- 确定您是单独编写程序还是作为团队的一部分编写程序。
- 定义您的测试/反馈/发布策略。
- 确定如何备份代码。

然而，作为一个新程序员，这些问题的答案通常很简单：你正在编写一个供你自己使用的程序，在你自己的系统上，使用你购买或下载的 IDE，并且你的代码不仅可能被任他人使用，也可能被自己使用。这使事情变得容易。

也就是说，如果您要处理任何非常复杂的事情，您应该有一个**<u>备份代码</u>**的计划。仅将目录压缩或复制到计算机上的另一个位置是不够的（尽管这总比没有好）。如果您的系统崩溃，您将失去一切。一个好的备份策略包括完全从系统中获取代码副本。有很多简单的方法可以做到这一点：将其压缩并通过电子邮件发送给自己，将其复制到 Dropbox 或其他云服务，将其通过 FTP 传输到另一台计算机，将其复制到本地网络上的另一台计算机，或使用版本控制系统驻留在另一台机器或云中（例如 <u>github</u>）。版本控制系统具有额外的优势，不仅可以恢复您的文件，还可以将它们回滚到以前的版本。

### 设计步骤 4：将困难问题分解为简单问题

在现实生活中，我们经常需要执行非常复杂的任务。试图弄清楚如何完成这些任务可能非常具有挑战性。在这种情况下，我们经常使用**自上而下的**方法来解决问题。也就是说，我们不是解决单个复杂任务，而是将该任务分解为多个子任务，每个子任务都更容易单独解决。如果这些子任务仍然太难解决，可以进一步分解。通过不断地将复杂的任务拆分为更简单的任务，您最终可以达到一个点，即每个单独的任务都可以管理，即使不是微不足道的。

让我们看一个例子。假设我们要打扫房子。我们的任务层次结构目前如下所示：

- 打扫房屋

一次打扫整个房子是一项相当大的任务，所以让我们将其分解为子任务：

- 打扫房屋
  - 用吸成器清理地毯
  - 清洁浴室
  - 清理厨房

这更易于管理，因为我们现在有了可以单独关注的子任务。但是，我们可以进一步分解其中一些：

- 打扫房屋
  - 用吸成器清理地毯
  - 清洁浴室
    - 擦洗马桶（糟糕！）
    - 洗水槽
  - 清理厨房
    - 清理台面
    - 清洁台面
    - 擦洗水槽
    - 把垃圾带出去

现在我们有了一个层次结构的任务，没有一个特别难。通过完成这些相对易于管理的子项目中的每一个，我们可以完成更艰巨的打扫房屋的整体任务。

创建任务层次结构的另一种方法是**自下而上进行**。在此方法中，我们将从简单任务列表开始，并通过对它们进行分组来构建层次结构。

举个例子，很多人平日要上班或上学，那么假设我们要解决“上班”的问题。如果有人问你早上从床上到工作做了什么任务，你可能会想出以下列表：

- 挑选衣服
- 穿上衣服
- 吃早餐
- 开车上班
- 刷牙
- 起床
- 准备早餐
- 上你的车
- 洗个淋浴

使用自下而上的方法，我们可以通过寻找将具有相似性的项目组合在一起的方法将它们组织成项目的层次结构：

- 从床上起来上班
  - 卧室的东西
    - 起床
    - 挑选衣服
    - 穿上衣服
  - 浴室用品
    - 洗个淋浴
    - 刷牙
  - 早餐的东西
    - 准备麦片
    - 吃麦片
  - 交通工具
    - 上你的车
    - 开车上班

事实证明，这些任务层次结构在编程中非常有用，因为一旦有了任务层次结构，就基本上定义了整个程序的结构。顶级任务（在本例中为“打扫房间”或“上班”）变为 main()（因为它是您要解决的主要问题）。子项成为程序中的函数。

如果事实证明其中一项（功能）太难实现，只需将该项拆分为多个子项/子功能。最终，您应该达到程序中的每个功能都可以轻松实现的程度。

### 设计步骤 5：找出事件的顺序

现在您的程序已经有了结构，是时候确定如何将所有任务链接在一起了。第一步是确定将要执行的事件的顺序。比如早上起床的时候，你按照什么顺序做上面的任务？它可能看起来像这样：

- 卧室的东西
- 浴室用品
- 早餐的东西
- 交通工具

如果我们正在编写一个计算器，我们可能会按以下顺序执行操作：

- 从用户那里获取第一个号码
- 从用户那里获取数学运算
- 从用户那里获取第二个号码
- 计算结果
- 打印结果

在这一点上，我们已经准备好实施了。

## 2. 实现

### 实施步骤 1：概述您的主要功能

现在我们准备开始实施。上述序列可用于概述您的主程序。暂时不要担心输入和输出。

```cpp
int main()
{
//    doBedroomThings();
//    doBathroomThings();
//    doBreakfastThings();
//    doTransportationThings();

    return 0;
}
```

或者在计算器的情况下：

```cpp
int main()
{
    // Get first number from user
//    getUserInput();

    // Get mathematical operation from user
//    getMathematicalOperation();

    // Get second number from user
//    getUserInput();

    // Calculate result
//    calculateResult();

    // Print result
//    printResult();

    return 0;
}
```

请注意，如果您打算使用这种“大纲”方法来构建程序，您的函数将无法编译，因为定义还不存在。在您准备好实现函数定义之前注释掉函数调用是解决此问题的一种方法（以及我们将在此处展示的方法）。或者，您可以*去掉*您的函数（或者创建一个空的函数体），以便您的程序能够编译。

### 实现步骤2：实现每个功能

在这一步中，对于每个函数，您将做三件事：

1. 定义函数原型（输入和输出）
2. 编写函数
3. 测试功能

如果您的函数足够细化，则每个函数都应该相当简单明了。如果一个给定的函数实现起来仍然过于复杂，也许它需要分解成更容易实现的子函数（或者你可能以错误的顺序做某事，并且需要重新审视你的事件顺序）。

让我们执行计算器示例中的第一个函数：

```cpp
#include <iostream>

// Full implementation of the getUserInput function
int getUserInput()
{
    std::cout << "Enter an integer ";
    int input{};
    std::cin >> input;

    return input;
}

int main()
{
    // Get first number from user
    int value{ getUserInput() }; // Note we've included code here to test the return value!
    std::cout << value; // debug code to ensure getUserInput() is working, we'll remove this later

    // Get mathematical operation from user
//    getMathematicalOperation();

    // Get second number from user
//    getUserInput();

    // Calculate result
//    calculateResult();

    // Print result
//    printResult();

    return 0;
}
```

首先，我们确定*getUserInput*函数不接受任何参数，并将返回一个 int 值给调用者。这反映在返回值为 int 且没有参数的函数原型中。接下来，我们编写了函数的主体，即简单的 4 条语句。最后，我们在函数*main*中实现了一些临时代码来测试函数*getUserInput*（包括它的返回值）是否正常工作。

我们可以使用不同的输入值多次运行该程序，并确保程序此时的行为符合我们的预期。如果我们发现某些东西不起作用，我们就知道问题出在我们刚刚编写的代码中。

一旦我们确信程序在这一点上是按预期工作的，我们可以删除临时测试代码，并继续执行下一个函数（函数*getMathematicalOperation*）。我们不会在本课中完成该程序，因为我们需要先介绍一些其他主题。

记住：**不要一次性实现整个程序。分步进行，在继续之前测试每个步骤。**

### 实施步骤 3：最终测试

一旦你的程序“完成”，最后一步是测试整个程序并确保它按预期工作。如果它不起作用，请修复它。

## 3. 编写程序时的忠告

**让您的程序易于启动**。通常，新程序员都有一个宏伟的愿景，那就是希望他们的程序能做他们想要的所有事情。“我想写一个角色扮演游戏，带有图形和声音以及随机的怪物和地下城，你可以去一个城镇出售你在地下城中找到的物品”。如果你试图写一些过于复杂而无法开始的东西，你会对自己缺乏进步感到不知所措和气馁。相反，让你的第一个目标尽可能简单，在你力所能及的范围之内。例如，“我希望在屏幕上能显示二维区块”。

**随着时间的推移添加功能**。一旦您的简单程序能够运行良好，您就可以为其添加功能。例如，一旦您可以显示您的字段，添加一个可以四处走动的角色。一旦你可以四处走动，添加可能阻碍你进步的墙壁。一旦你有了墙，用它们建造一个简单的城镇。拥有城镇后，添加商人。通过逐步添加每个功能，您的程序将逐渐变得更加复杂，而不会在此过程中让您不知所措。

**一次专注于一个领域**。不要试图一次编写所有代码，也不要将注意力分散到多个任务上。一次专注于一项任务。一个工作任务和五个尚未开始的任务比六个部分工作的任务要好得多。如果你分散注意力，你就更有可能犯错误并忘记重要的细节。

**随时测试每段代码**。新程序员通常会一口气写完整个程序。然后当他们第一次编译它时，编译器会报告数百个错误。这不仅令人生畏，如果您的代码不起作用，可能很难找出原因。相反，编写一段代码，然后立即编译和测试。如果它不起作用，您将确切知道问题出在哪里，并且很容易解决。一旦您确定代码有效，请移至下一部分并重复。完成编写代码可能需要更长的时间，但是当你完成后，整个事情应该可以工作，而且你不必花费两倍的时间来查明它为什么不能运行的bug。

**不要在完善早期代码上投入**。功能（或程序）的初稿很少是令人满意的。此外，随着您添加功能并找到更好的方法来构建事物，程序往往会随着时间而发展。如果您过早地投资于完善您的代码（添加大量文档、完全遵守最佳实践、进行优化），您可能会在需要更改代码时失去所有投资。相反，让您的功能最低限度地工作，然后继续前进。当您对自己的解决方案充满信心时，可以持续地打磨。但不要追求完美——重要的程序永远不会完美，总有更多的事情可以做来改进它们。变得足够好并继续前进。

大多数新程序员会简化其中的许多步骤和建议（因为这似乎需要大量工作和/或它不像编写代码那么有趣）。但是，对于任何重要的项目，从长远来看，遵循这些步骤肯定会为您节省大量时间。预先进行一点计划可以在最后节省大量调试。

好消息是，一旦你对所有这些概念感到满意，它们就会开始更自然地出现在你身上。最终，您将达到可以编写整个函数而无需任何预先计划的地步。
